# 1 概述

本文档介绍HYSylixOS集成开发环境HWIIoTStudio软件的功能与使用。
HWIIoTStudio是一套基于Eclipse开发的HYSylixOS集成开发环境，其中包含了一系列开发及调试插件。HWIIoTStudio对Eclipse C/C++插件CDT进行了大量的扩展和改造，使之更加符合HYSylixOS的开发流程，Eclipse使用java语言开发，因此HWIIoTStudio的运行依赖于java虚拟机（JRE 1.8以上版本）。

HWIIoTStudio的主要功能是对HYSylixOS进行代码的管理（编辑、编译等）、程序调试以及文件推送等。

## 1.1 HWIIoTStudio和HYSylixOS

HYSylixOS是一款大型实时操作系统，支持对称多处理器（SMP）平台，支持ARM、x86等架构处理器，支持主流国产通用处理器，如飞腾1500A等。

HWIIoTStudio包含一系列开发调试插件，提供完整的HYSylixOS嵌入式开发解决方案，集设计、开发、调试、仿真、部署、测试功能于一体。

HWIIoTStudio在宿主机上运行，通过网络或串口与目标机交互。

HWIIoTStudio的交叉编译器在宿主机上编译生成可以在目标机上运行的HYSylixOS镜像文件，交叉调试器实现宿主机与目标机之间的前后台调试。

HWIIoTStudio的主要功能是HYSylixOS工程管理和程序调试。HWIIoTStudio可以创建海鹰高性能操作系统通用处理器版模块项目工程、海鹰高性能操作系统通用处理器版动态库项目工程、海鹰高性能操作系统通用处理器版静态库项目工程、海鹰高性能操作系统通用处理器版应用程序项目工程。支持一键推送调试、手动启动调式、通过串口调试、动态库调试及Attach到进程调试，所有调试方式在多线程调试时都支持Non-stop模式。

HWIIoTStudio主要集成以下开发工具：  

- 交叉编译工具链；
- 硬件平台模拟器；
- 性能分析工具；
- 代码覆盖率分析工具；
- 代码编辑器；
- 远程系统访问工具。

## 1.2 HWIIoTStudio 主界面

安装完HWIIoTStudio软件后，双击电脑桌面上的“hwstudio”软件图标启动WIIoTStudio。启动过程中会弹出工作空间(Workspace)选择页面，如图1.1所示；Workspace概念源自Eclipse，是系统中的一个文件夹，Workspace中保存了用户对HWIIoTStudio的一些全局设置，如界面风格等。当创建一个工程时，其默认路径在Workspace对应的文件夹中。

@import "./image/hyuse0101.png" 

<center>图 1.1 选择Workspace工作空间</center>  

选择Workspace所在文件夹，如果新建Workspace，则选择一个空文件夹，点击“OK”进入HWIIoTStudio主界面。HWIIoTStudio主界面沿用了Eclipse的界面风格，加入了HYSylixOS元素，并在字体、图标等方面做了美化，如图1.2所示。

@import "./image/hyuse0102.png" 

<center>图 1.2 HWIIoTStudio主界面</center>

# 2 创建工程

使用 HWIIoTStudio可以创建各种 HYSylixOS工程，依照工程向导创建的工程不需要增加任何设置就可以编译和调试。  

选择菜单“文件(F)→新建(N)→项目(R)”，弹出窗口中列出了HYSylixOS支持的工程类型，如图2.1所示。

@import "./image/hyuse0201.png"

<center>图 2.1 创建项目工程</center>

目前HWIIoTStudio支持的项目工程有：  

- 海鹰高性能操作系统通用处理器版 模块 项目：HYSylixOS内核模块，类似Linux系统下的.ko模块；
- 海鹰高性能操作系统通用处理器版 动态库 项目：HYSylixOS动态链接库程序，类似Linux系统下的.so文件；
- 海鹰高性能操作系统通用处理器版 静态库 项目：HYSylixOS静态链接库程序；
- 海鹰高性能操作系统通用处理器版 应用程序 项目：HYSylixOS应用程序；

> 注：工程一旦成功创建，请不要再重命名工程。

## 2.1 创建 HYSylixOS 模块 工程

在图 2.1对话框中选择“海鹰高性能操作系统通用处理器版 模块 项目”，进入到如图2.2所示的项目创建界面，在项目名(P)这一栏填写工程名称，工程名称不允许包含空格，取消勾选“使用缺省位置(D)”，可在默认工作空间之外的位置创建工程。

@import "./image/hyuse0202.png" 

<center>图 2.2 创建内核模块项目工程</center>  

点击“下一步(N)”进入操作系统内核设置界面，如图 2.3所示，

@import "./image/hyuse0203.png" 

<center>图 2.3 海鹰模块项目工程操作系统内核设置</center>

配置项解析：

- 操作系统内核项目：依赖的Base项目工程路径，点击“浏览”按钮可以在当前文件系统中查找Base项目，点击“默认”按钮即可选取HWIIoTStudio开发环境自带的默认Base项目工程；
- 编译工具链：本项在HYSylixOS 模块 项目工程中无法使用，会自动与选取的HYSylixOS Base工程保持一致；
- 目标代码类型：海鹰提供Debug和Release两种调试级别；
- 处理器类型：本项在HYSylixOS 模块 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 协处理器类型：本项在HYSylixOS 模块 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 专业模式设置：用户可以选择是否定制化Makefile配置以及是否不扫描源文件；

    - 定制化Makefile配置：这里所述Makefile包含工程目录下文件名为Makefile的文件以及所有后缀名为mk的文件，勾选此选项则需要用户自己修改Makefile，一般用户则不推荐定制化Makefile配置；

    - 不扫描源文件：HWIIoTStudio会在每次用户编译时扫描工程目录下的源码文件列表并更新Makefile，如有特殊需求可不扫描，一般用户则不推荐使用。

点击“完成(F)”按钮即可完成海鹰翼辉操作系统通用处理器版模块项目工程的创建，然后右键点击该工程，在弹出的对话框中选择“构建项目(B)”选项即可完成编译，也可以点击上方的小锤子按钮进行编译，如图 2.4所示，若想对项目工程进行重新编译，有两种方法，第一种方法是：先点击“清空项目”然后再点击“构建项目(B)”，完成项目的重构；第二种方法：直接点击“重新构建”或选中工程采用快捷键Alt+B来完成项目的重构，编译完成的内核模块工程如图 2.5。

@import "./image/hyuse0204.png" 

<center>图 2.4 项目的构建或重构</center>

@import "./image/hyuse0205.png" 

<center>图 2.5 海鹰内核模块项目工程编译</center>

编译完成后在 Debug 文件夹里生成Module.ko，strip文件夹下Module.ko的是缩略版。

## 2.2 部署模块

使用HWIIoTStudio的一键部署功能可以将上一步编译的内核模块文件（本例为“Module.ko”）下载到“/lib/modules”目录，上传的配置方法如下：右键点击Module工程，在弹出的菜单中选择“属性(R)”打开工程属性页，选择“操作系统项目设置→目标机设置”选项卡查看或更改部署配置，在创建模块工程时会自动配置好上传目标机设置，只需要通过目标机名的下拉选项来选择已经保存的目标机名称，若名称不存在则需要通过“新建目标机定义”按钮来进行创建目标机名称的操作，如图2.6所示。

@import "./image/hyuse0206.png" 

<center>图 2.6 海鹰内核模块项目工程上传设置</center>

设置完成后，右键“Module”项目工程，选择菜单“海鹰操作系统→上传目标机”来上传工程到目标机，也可以直接选中该项目工程，通过“Alt+D”快捷键直接上传到目标机，需要注意的是上传时目标机必须处于运行状态，否则将发生找不到目标机的错误。

在HYSylixOS Shell 上，运行“modulereg”命令加载内核模块，然后使用“modules”命令。

查看当前已经加载的内核模块，并可以获得模块句柄（“HANDLE”部分）根据获取到的模块句柄，使用“moduleunreg”命令可卸载内核模块，如图2.7。

@import "./image/hyuse0207.png" 

<center>图 2.7 部署模块相关命令</center>

> 注：printk函数只会输出到串口终端，如果在module_init或module_exit函数中使用了printk函数作为输出函数，则telnet终端上不会打印输出。

## 2.3 创建 HYSylixOS动态库 工程

在图2.1对话框中选择“海鹰高性能操作系统通用处理器版 动态库 项目”，点击“下一步(N)”，进入到如图2.8所示的创建项目界面，在该界面中输入工程名称（本例为“ShareLib”），然后再次点击“下一步(N)”进入图2.9所示界面。

@import "./image/hyuse0208.png" 

<center>图 2.8 创建动态库项目工程</center>

@import "./image/hyuse0209.png" 

<center>图 2.9 海鹰动态库操作系统内核设置</center>

配置项解析：

- 操作系统内核项目：依赖的Base项目工程路径，点击“浏览”按钮可以在当前文件系统中查找Base项目，点击“默认”按钮即可选取HWIIoTStudio开发环境自带的默认Base 项目；
- 编译工具链：本项在HYSylixOS 动态库 项目工程中无法使用，会自动与选取的HYSylixOS Base工程保持一致； 
- 目标代码类型：海鹰提供Debug和Release两种调试级别；
- 处理器类型：本项在HYSylixOS 动态库 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 协处理器类型：本项在HYSylixOS 动态库 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 专业模式设置：用户可以选择是否定制化Makefile配置以及是否不扫描源文件；
- 定制化Makefile配置：这里所述Makefile包含工程目录下文件名为Makefile的文件以及所有后缀名为mk的文件，勾选此选项则需要用户自己修改Makefile，一般用户则不推荐定制化Makefile配置；
- 不扫描源文件：HWIIoTStudio会在每次用户编译时扫描工程目录下的源码文件列表并更新Makefile，如有特殊需求可不扫描，一般用户则不推荐使用。

海鹰翼辉操作系统通用处理器版动态 项目工程向导生成了一个简单的可编译运行的动态链接库程序（方法详见2.1节），如图 2.10所示。

@import "./image/hyuse0210.png" 

<center>图 2.10 海鹰动态库项目工程编译</center>

编译完成后会生成如下文件：

- libShareLib.so：动态链接库文件；
- libShareLib.a：静态链接库文件。

>   同样的strip文件夹下的lib ShareLib.so是缩略版的。

## 2.4 部署动态链接库

将上一步编译的动态链接库文件（本例为“libShareLib.so”）上传到目标机的“/lib/”目录，（或者其他HYSylixOS动态库搜索路径，如“/usr/lib”、“/usr/local/lib”等）；如果应用程序在编译时引用了该库文件，则在应用程序运行时，加载器会自动加载动态链接库。

可以使用HWIIoTStudio的一键部署功能实现动态库的上传，右键点击Module工程，在弹出的菜单中选择“属性(R)”打开配置界面，通过选择“操作系统项目设置→目标机设置”选项卡查看或更改部署配置，在创建模块工程时，HWIIoTStudio默认会添加工程当前配置输出文件夹下与工程名同名的文件到文件列表，如图2.11所示。

@import "./image/hyuse0211.png" 

<center>图 2.11 海鹰动态库上传设置</center>

设置完成后，右键“ShareLib”项目工程，选择菜单“海鹰操作系统→上传目标机”来上传工程到目标机，也可以直接选中该项目工程，通过“Alt+D”快捷键直接上传到目标机。

## 2.5 创建 HYSylixOS静态库 工程

在图 2.1对话框中选择“海鹰高性能操作系统通用处理器版静态库项目”，可创建HYSylixOS静态库工程，点击下一步(N)进入到如图2.12所示的创建项目界面，在该界面中可以对静态库项目工程进行命名，然后再次点击下一步(N)进入到如图2.13所示界面。

@import "./image/hyuse0212.png" 

<center>图 2.12 创建静态库项目工程</center>

@import "./image/hyuse0213.png" 

<center>图 2.13 海鹰静态库操作系统内核设置</center>

配置项解析：

- 操作系统内核项目：依赖的Base项目工程路径，点击“浏览”按钮可以在当前文件系统中查找Base项目，点击“默认”按钮即可选取HWIIoTStudio开发环境自带的默认Base 项目；
- 编译工具链：本项在HYSylixOS 静态库 项目工程中无法使用，会自动与选取的HYSylixOS Base工程保持一致；
- 目标代码类型：海鹰提供Debug和Release两种调试级别；
- 处理器类型：本项在HYSylixOS 静态库 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 协处理器类型：本项在HYSylixOS 静态库 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 专业模式设置：用户可以选择是否定制化Makefile配置以及是否不扫描源文件；

    - 定制化Makefile配置：这里所述Makefile包含工程目录下文件名为Makefile的文件以及所有后缀名为mk的文件，勾选此选项则需要用户自己修改Makefile，一般用户则不推荐定制化Makefile配置；

    - 不扫描源文件：HWIIoTStudio会在每次用户编译时扫描工程目录下的源码文件列表并更新Makefile，如有特殊需求可不扫描，一般用户则不推荐使用。

海鹰高性能操作系统通用处理器版静态库项目工程向导生成了一个简单的可编译运行的静态链接库程序（方法详见2.1节），如图2.14所示。

@import "./image/hyuse0214.png" 

<center>图 2.14 海鹰静态库项目工程编译</center>

编译完成后生成libStaticLib.a文件（静态链接库文件），需要特别说明的是海鹰静态库的编译参数中不带-fPIC选项，因此生成.a文件只能用于海鹰BSP工程链接，不能用于海鹰应用程序和动态库的链接；海鹰静态库工程中同样会生成.a文件，该文件的编译选项中带-fPIC参数，可用于海鹰应用程序和动态库的链接。

## 2.6 创建HYSylixOS 应用程序工程

在图 2.1对话框中选择“海鹰高性能操作系统通用处理器版 应用程序 项目”，点击进行下一步(N)，在弹出的图2.15所示的创建界面填写应用程序工程名称（本例为“AppProgram”），再次点击进入下一步(N)，进入如图2.16所示界面。

@import "./image/hyuse0215.png"

<center>图 2.15 创建应用程序项目工程</center>

@import "./image/hyuse0216.png" 

<center>图 2.16 海鹰应用程序项目工程操作系统内核设置</center>

配置项解析：

- 操作系统内核项目：依赖的Base项目工程路径，点击“浏览”按钮可以在当前文件系统中查找Base项目，点击“默认”按钮即可选取HWIIoTStudio开发环境自带的默认Base 项目；
- 编译工具链：本项在HYSylixOS 应用程序 项目工程中无法使用，会自动与选取的HYSylixOS Base工程保持一致；
- 目标代码类型：海鹰提供Debug和Release两种调试级别；
- 处理器类型：本项在HYSylixOS 应用程序 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 协处理器类型：本项在HYSylixOS 应用程序 项目工程中无法使用，自动与选取的HYSylixOS Base工程保持一致；
- 专业模式设置：用户可以选择是否定制化Makefile配置以及是否不扫描源文件；

    - 定制化Makefile配置：这里所述Makefile包含工程目录下文件名为Makefile的文件以及所有后缀名为mk的文件，勾选此选项则需要用户自己修改Makefile，一般用户则不推荐定制化Makefile配置；

    - 不扫描源文件：HWIIoTStudio会在每次用户编译时扫描工程目录下的源码文件列表并更新Makefile，如有特殊需求可不扫描，一般用户则不推荐使用。

海鹰高性能操作系统通用处理器版应用程序项目工程向导生成了一个简单的可编译运行的应用程序（方法详见2.1节），如图2.17所示。

@import "./image/hyuse0217.png" 

<center>图 2.17 海鹰应用程序项目工程编译</center>

编译完成后将在Debug文件夹下生成AppProgram二进制文件（应用程序可执行文件）。

## 2.7 部署和运行APP

首先将应用程序编译生成的文件下载到目标机设备中，海鹰推荐使用标准的应用程序目录结构，即每个应用在“/apps”目录创建自己的子目录，如本例创建的就是“/AppProgram”目录，然后将上一步编译生成的可执行二进制文件下载到其中。可使用HWIIoTStudio的一键部署功能实现程序的下载，右键点击“AppProgram”工程，在弹出的菜单栏中选择“属性(R)”打开工程的属性配置界面，通过选择“操作系统项目设置→目标机设置”选项卡查看或更改部署配置；
在创建海鹰高性能操作系统通用处理器版应用程序项目工程时，HWIIoTStudio默认会添加工程当前配置输出文件夹下与工程名同名的文件到文件列表，如图2.18所示。

@import "./image/hyuse0218.png" 

<center>图 2.18 海鹰应用程序项目工程上传设置</center>

设置完成后，右键“AppProgram”项目工程，选择菜单“海鹰操作系统→上传目标机”来上传工程到目标机，也可以直接选中该项目工程，通过“Alt+D”快捷键直接上传到目标机。

> 注：如果部署不成功需要检查防火墙是否处于关闭状态。

启动终端显示软件（本例启动的是Xshell 6软件），在终端上输入“cd /apps/AppProgram”的指令切换到“AppProgram”目录中，然后再通过指令“./AppProgram”直接运行新创建的应用程序，运行效果如图 2.19所示。

@import "./image/hyuse0219.png" 

<center>图 2.19 应用程序执行</center>

HWIIoTStudio支持远程Shell，进入到设备列表界面，在目标设备上右击，点击“启动终端”可打开终端设备，在打开的终端上输入命令运行即可，如图2.20 HYSylixOS远程Shell执行应用程序。

@import "./image/hyuse0220.png" 

<center>图 2.20 海鹰远程Shell执行应用程序</center>

# 3 导入工程

HWIIoTStudio工程是HYSylixOS源码管理的原子单位，可以在多个HWIIoTStudio工作空间内移动和共享工程；HYSylixOS官方源码版本库中的源码同样以HWIIoTStudio工程形式组织，从版本库检出的工程可以被导入到HWIIoTStudio的工作空间中。

## 3.1 工程导入

本文档假定从海鹰的项目工程中选取应用程序类的工程，右键点击HWIIoTStudio的项目资源管理器的空白处，在弹出的菜单中选择“导入(I)”，打开导入选择对话框，如图3.1所示。

@import "./image/hyuse0301.png" 

<center>图 3.1 导入工程</center>

先选中“General→现有项目到工作空间中”后点击下一步(N)进入到工程选择界面，如图3.2所示，在“选择根目录(T)”这一项通过浏览找到项目工程所在的本地路径，然后在出现的“项目(P)”中选择对应的项目工程（本例是“pSuite_test”工程），点击“完成(F)”即可完成项目的导入，根目录越详细越好，最好能具体到项目工程本身。

@import "./image/hyuse0302.png" 

<center>图 3.2 选择要导入的项目工程</center>

导入成功后，可以在项目资源管理器看到新导入的工程，如图 3.3所示。

@import "./image/hyuse0303.png" 

<center>图 3.3 导入完成</center>

## 3.2 工程删除

如图3.4所示，在项目资源管理器界面右键点击待删除的项目工程，然后在弹出的菜单中选择“删除(D)”，就会弹出删除资源对话框，如图3.5所示，点击“确定”按钮即可将“pSuite_test”项目工程从资源管理器界面移除，若想将此项目完全删除，则需要勾选“删除磁盘上的项目内容(无法撤销)(D)”就可以将项目工程从本地磁盘中删除。

@import "./image/hyuse0304.png" 

<center>图 3.4 项目工程删除第一步</center>

@import "./image/hyuse0305.png" 

<center>图 3.5 项目工程删除第二步</center>

# 4 修改工程

HWIIoTStudio使用Makefile方式管理工程，Makefile在创建工程时生成，在非专家模式下不需要用户去手动维护，HWIIoTStudio会提供规范简单的Makefile模板，在专家模式下用户可以很方便的对Makefile进行修改。

## 4.1 修改工程通用设置

在HWIIoTStudio的项目资源管理器界面右键点击需要修改的工程，在弹出的菜单中选择“属性(R)”打开属性配置界面，选择“操作系统项目设置”，如图4.1所显示的界面可以对“操作系统内核项目”、“目标代码类型”、“专业模式设置”进行修改，“操作系统内核项目”可以更改工程所使用的base，确保其存在且不会与目标机的操作系统冲突；“目标代码类型”目前可以选择的只有“Debug”和“release”模式；“专业化模式设置”可以设置是否定制化Makefile配置以及是否不扫描源文件。

@import "./image/hyuse0401.png" 

<center>图 4.1 修改通用设置</center>

配置项解析：

- 操作系统内核项目：所依赖的海鹰base工程路径，点击浏览可从本地文件系统中自主选择海鹰base工程，若点击默认则会使用HWIIoTStudio开发环境自带的海鹰base工程；
- 编译工具链：与选取的海鹰base工程保持一致，一般工程无法进行修改；
- 目标代码类型：又名调试类型，海鹰提供debug（调试模式）和release（商业模式）两种模式；
- 处理器类型：与选择的海鹰base工程保持一致，一般工程无法进行修改；
- 协处理器类型：与选择的海鹰base工程保持一致，无法进行修改；
- 专业模式设置：可以称之为开发者模式，用户可以选择是否定制化Makefile配置以及是否不扫描源文件；勾选定制化Makefile配置则需要用户去手动修改Makefile文件，开发环境本身将不会对其进行修改；勾选不扫描源文件，开发环境将不会对新编代码进行扫描编译，会一致保持现有的状态。

点击“确定”按钮确认通用设置的修改，HWIIoTStudio会自动生成Makefile配置文件；HWIIoTStudio将重新生成工程根目录下的config.mk文件，工程根目录下的config.mk文件不允许手动修改。

## 4.2 添加源文件

在项目资源管理器界面选中工程本身或工程内的文件夹右键点击，在弹出的菜单中选择“新建(N)→源文件”，弹出如图4.2所示的新建源文件对话框，在“源文件夹(D)”这一栏可以修改源文件在工程中所处于的位置（本例在“src”文件夹下），在“Source file”这一栏填写源文件的名称，然后点击“完成(F)”即可成功添加源文件；同样也可以采用上述的方法来添加文件夹、源头文件等。

@import "./image/hyuse0402.png" 

<center>图 4.2 新建源文件</center>

在不勾选“专家模式设置”中的选项时，HWIIoTStudio会自动将新添加的源文件一起编译，编译后可以查看AppProgram.mk文件，可以看到源文件列表已经自动添加了新建的源文件，如图4.3。

@import "./image/hyuse0403.png" 

<center>图 4.3 源文件列表</center>

## 4.3 添加头文件路径

在项目资源管理器界面右键点击要添加头文件的工程，在弹出的菜单中选择“属性(R)→操作系统项目设置→编译设置”下的“头文件定义”，在此界面中可以通过点击“工作组”、“内核”或“文件系统”按钮功能来进行头文件路径的添加，本例就是采用通过“工作组”的方式进行头文件路径的添加，如图4.4所示，选中需要添加的头文件的上一级目录再点击“确定”即可完成头文件路径的添加工作。

@import "./image/hyuse0404.png" 

<center>图 4.4 添加头文件设置</center>

在不勾选“专家模式设置”中的选项时，HWIIoTStudio会自动将新添加的头文件一起编译编译后查看AppProgram.mk文件，可以看到头文件路径列表已经自动添加新增的头文件路径，如图4.5。

@import "./image/hyuse0405.png" 

<center>图 4.5 头文件路径列表</center>

## 4.4 添加动态库

在项目资源管理器界面右键点击要添加动态库的项目工程，在弹出的菜单中选择“属性(R)→操作系统项目设置→链接设置”下的“链接器设置”，在此界面中可以通过“名称”、“输出”、“工作组”、“内核”或“文件系统”按钮功能添加动态库，本例中选择的是通过“输出”按钮添加动态库，如图4.6所示，在弹出的对话框中选择Output文件下的.so文件（本例是“libShareLib.so”），strip文件夹下的是压缩版的.so文件。

@import "./image/hyuse0406.png" 

<center>图 4.6 添加动态库</center>

点击“确定”后，在弹出的对话框“是否把这个目录设置为库路径？”中选择“是(Y)”即可完成动态库的添加。如图4.7，在“库路径”界面可以查看已经添加成功的库文件路径。

@import "./image/hyuse0407.png" 

<center>图 4.7 库路径添加成功</center>

在不勾选“专家模式设置”中的选项时，重新编译工程后打开“AppProgram.mk”文件，可以看到库文件链接已经自动添加新增的库文件路径，如图4.8所示。

@import "./image/hyuse0408.png" 

<center>图 4.8 动态库路径自动添加</center>

## 4.5 专家模式

在专家模式下，新建的源文件，新增的头文件路径，新增的动态库等都需要用户手动设置，主要是修改“源文件名.mk”文件，如图4.9所示，其中主要几项说明如下：

-  “LOCAL_TARGET_NAME”：输出文件，可以设置工程的多目标输出；
- “LOCAL_SRCS”：源文件列表，添加源文件后，需要在此列表中添加后才能编译；
- “LOCAL_INC_PATH”：头文件搜索路径，添加头文件后，需在此添加后才能搜索；
- “LOCAL_DSYMBOL”：预定义宏；
- “LOCAL_DEPEND_LIB”：依赖的库文件，添加的库文件需在此列出；
- “LOCAL_DEPEND_LIB_PATH”：依赖的库文件路径；
- “LOCAL_USE_GCOV”：是否启用代码覆盖率分析。

@import "./image/hyuse0409.png" 

<center>图 4.9 专家模式下手动设置项</center>

# 5 HWIIoTStudio调试

HYSylixOS实现了一个功能强大的调试stub，可在设备或模拟器上在线调试应用程序，HWIIoTStudio也提供配套的调试插件。目前HWIIoTStudio既支持自动推送调试、也支持传统的手动启动gdbserver的调试方式。本节将逐一介绍。

> 注：本节所述调试方法同时适应硬件设备和RealEvo-Simulator模拟器上运行的应用程序，内核和BSP的调试方法请参考附件中的《RealEvo-Simulator使用手册》。

> 注：需要注意，调试应用程序依赖的libvpmpdm.so必须是Debug版本，否则将会因为Release版本的libvpmpdm.so没有调试信息导致未知的错误，这个问题会在所有被调试应用程序链接的动态库（如：libcextern等）上出现。

## 5.1 一键推送调试

使用HWIIoTStudio实现一键推送调试功能，不需要用户在设备上手动启动gdbserver，也不需要用户手动下载程序到设备。其操作流程如下：
选中需要调试的工程，这里选择“AppProgram”项目工程，按照图2.17设置设备，并保证可以成功连接到设备。

在项目资源管理器界面右键点击“AppProgram”工程，在弹出的菜单中选择“调试方式(D)→海鹰高性能操作系统程序通用处理器版项目”可以直接进入调试，这种方式简单快捷，但在调试退出后并不保存调试对象。下面介绍建立调试器的一键推送调试方法。

选中工程，选择上方的菜单“运行(R)→运行配置(N)”打开调试器界面；选择“海鹰高性能操作系统程序”后右键点击，在出现的菜单栏中选择“新建(W)”按钮，新建一个调试器对象，并在“名称(N)”编辑框内填写调试器对象名字，本例为“AppProgram_auto”，点击“应用(Y)”应用设置，点击“运行(R)”开始调试，如图5.1。

@import "./image/hyuse0501.png" 

<center>图 5.1 新建调试器</center>

调试界面如图5.2，可以在“控制台”标签页查看gdb输入信息，在设备“终端”标签页查看调试过程中应用程序的输出信息，并且可以在其中输入执行Shell命令。

@import "./image/hyuse0502.png" 

<center>图 5.2 设备调试界面</center>

在调试界面右键点击工程，可以在弹出的菜单栏中选择“终止(T)”或者上方的还不够色标志按钮或快捷键“Ctrl+F2”来结束调试，调试结束后可以点击如图5.3所示界面中的按钮（左侧第二个），在下拉菜单中点击调试器对象（本例为“AppProgram_auto”）可重新开始调试，也可以右键点击工程，在弹出的菜单中选择“重新启动(L)”接口重新开始调试。

@import "./image/hyuse0503.png" 

<center>图 5.3 停止和重新开始调试</center>

HWIIoTStudio会依据应用程序修改时间判断是否需要重新推送程序，所以无须担心推送程序所产生的网络流量和读写延时问题。

## 5.2 手动启动调式

> 注：本节涉及的Shell命令可参考附件中的《海鹰翼辉嵌入式操作系统Shell命令手册》。
- **启动gdbserver。**

使用debug命令启动应用程序。在命令中指定监听的网络接口和端口，后跟需要启动的应用程序和参数，如图5.4。

@import "./image/hyuse0504.png" 

<center>图 5.4 启动gdbserver</center>

> 注：上面命令中“./APPdemo”中的“./”不能省略，否则程序加载器只会在\$PATH路径下查找，不会查找当前路径。

## 5.3 串口调试

对于不支持以太网接口的设备，可以使用串口进行手动启动调试。其操作流程与以太网调试基本一致，可参考5.2节，有以下两点区别。

1.  通过串口链接PC与设备，在设备端使用/dev/ ttyS\*参数启动debug命令，如图5.5所示；

@import "./image/hyuse0505.png" 

<center>图 5.5 通过串口启动debug</center>

图中的命令参数“/dev/ttyS0” 为设备端与PC相连的串口在海鹰中的名称。

2. 直接在HWIIoTStudio开发环境上方的菜单栏选择“工具(G)→串口终端”，打开如图5.6所示界面，在“串口”这一栏下拉选择PC端与设备相连的调试串口名称，在“波特率”这一栏下拉选择调试串口的波特率，海鹰调试串口波特率为115200。

@import "./image/hyuse0506.png" 

<center>图 5.6 调试串口设置</center>

> 注：如果目标设备没有第二个可以用于调试的串口，可以通过命令“debugterminal./AppProgram”将当前串口用于调试串口，但是需要注意的是调试启动后需要将串口关闭，否则HWIIoTStudio将会出现连接失败的错误。

## 5.4 动态库调试

海鹰支持动态库调试，添加动态库的方法详见节2.3；为AppProgram项目工程添加ShareLib动态库，修改AppProgram项目工程调用ShareLib中的函数，如图5.7，再按照节2.4部署依赖库文件。

@import "./image/hyuse0507.png" 

<center>图 5.7 调用动态库中函数</center>

## 5.5 Attach到进程
- **启动应用程序**

为便于定位突发问题，海鹰支持Attach到现有进程的调试方式。为演示Attach调试方式，本例修改源码，如图5.8让应用程序以死循环方式不间断运行。

@import "./image/hyuse0508.png" 

<center>图 5.8 程序示例</center>

# 6 设备管理

## 6.1 设备实时监控

HWIIoTStudio支持对在线设备的实时监控。进入“Device界面”，在左侧“Remote System Navigator”区域列出了工程中设置的所有设备。也可以在该区域点击右键，新建一个设备，按图2.9设置。右键一个在线设备，点击“Launch Device”，在“System Information”下列出了设备的内存信息、当前运行的进程及线程信息，如图6.1。设备信息每6s自动刷新一次，也可以在某个信息页面上点击右键手动刷新。对于非内核进程或线程，可以点击右键选择“Kill Process”或“Kill Thread”杀死该进程或线程。

@import "./image/hyuse0601.png" 

<center>图6.1 设备实时监控</center>

## 6.2 HYSylixOS远程Shell

HWIIoTStudio支持打开在线设备的终端，在设备列表中选择一个在线设备并右键点击，然后在弹出的菜单栏中点击“启动终端”，打开终端设备；在此终端上可以执行海鹰的Shell命令，并且使用鼠标可以将光标移动到当前命令行的任意位置，如图6.2所示。

@import "./image/hyuse0602.png" 

<center>图 6.2 设备终端</center>

## 6.3 设备文件系统访问

HWIIoTStudio支持访问在线设备的文件系统，在设备列表中右键点击一个在线设备，在弹出的菜单栏中选择“启动FTP”，打开设备的文件系统，如图6.3所示；在左侧的本地路径中选择文件后右键点击，在弹出的对话框中选择“上传”可以将本地路径下的文件上传到右侧的设备文件系统中，在右侧的设备文件系统上选择文件后右键点击，在弹出的对话框中选择“下载”可以将设备文件系统中的文件下载到左侧的本地路径中，如图6.4所示；对于设备上的文件，可以通过右键点击并选择“权限”选项卡后在弹出的对话框中来更改文件的权限。

@import "./image/hyuse0603.png" 

<center>图 6.3 打开设备文件系统</center>

@import "./image/hyuse0604.png" 

<center>图 6.4 向目标设备上传或下载文件</center>
