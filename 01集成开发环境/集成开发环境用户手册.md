
# 概述

本文档介绍HYSylixOS集成开发环境海鹰工坊的功能与使用。

海鹰工坊是一套基于Eclipse开发的HYSylixOS集成开发环境，其中包含了一系列开发及调试插件。海鹰工坊对EclipseC/C++插件CDT进行了大量的扩展和改造，使之更加符合HYSylixOS的开发流程，Eclipse使用java 语言开发，因此海鹰工坊的运行依赖于java虚拟机（JRE 1.8以上版本）。海鹰工坊的主要功能是对HYSylixOS进行代码的管理（编辑、编译等）、程序调试以及文件推送等。

## 海鹰工坊和HYSylixOS

HYSylixOS是一款大型实时操作系统，支持对称多处理器（SMP）平台，支持ARM、x86等架构处理器，支持主流国产通用处理器，如飞腾
1500A等。海鹰工坊包含一系列开发调试插件，提供完整的HYSylixOS嵌入式开发解决方案，集设计、开发、调试、仿真、部署、测试功能于一体。
海鹰工坊在宿主机上运行，通过网络或串口与目标机交互。海鹰工坊的交叉编译器在宿主机上编译生成可以在目标机上运行的HYSylixOS镜像文件，交叉调试器实现宿主机与目标机之间的前后台调试。

海鹰工坊的主要功能是HYSylixOS工程管理和程序调试。海鹰工坊可以创建HYSylixOSBase工程、创建HYSylixOS BSP工程、创建HYSylixOS App工程、创建 HYSylixOS SharedLib工程、创建HYSylixOS Kernel Module工程及创建HYSylixOS Kernel Static Lib工程。支持一键推送调试、手动启动调式、通过串口调试、动态库调试及Attach到进程调试，所有调试方式在多线程调试时都支持Non-stop模式。

海鹰工坊主要集成以下开发工具：

- 交叉编译工具链；
- 硬件平台模拟器；
- 性能分析工具；
- 代码覆盖率分析工具；
- 代码编辑器；
- 远程系统访问工具。

1. 海鹰工坊 主界面

安装完海鹰工坊软件后，双击电脑桌面上的“海鹰工坊”软件图标启海鹰工坊。启动过程中会弹出Workspace选择页面，如图1.1，Workspace概念源自Eclipse，是系统中的一个文件夹，Workspace中保存了用户对海鹰工坊的一些全局设置，如界面风格等。当创建一个工程时，其默认路径在Workspace对应的文件夹中。

@import "./image/选择Workspace.jpg"

<center>图1.1选择 Workspace</center>

选择Workspace 所在文件夹，如果新建Workspace，则选择一个空文件夹，点击“OK”进入海鹰工坊主界面。海鹰工坊主界面沿用了Eclipse的界面风格，加入了HYSylixOS元素，并在字体、图标等方面做了美化，如图1.2。

@import "./image/海鹰工坊主界面.png"

<center>图1.2 海鹰工坊主界面</center>

# 创建工程

使用 海鹰工坊可以创建各种 HYSylixOS 工程，依照工程向导创建的工程不需要增加任何设置就可以编译和调试。选择菜单“File→New→Project”，弹出窗口中列出了HYSylixOS支持的工程类型，如图2.1。

@import "./image/创建工程.png"

<center>图2.1创建工程</center>

目前海鹰工坊支持的工程有：

- HYSylixOS App：HYSylixOS应用程序；
- HYSylixOS Base：HYSylixOSBase工程包含HYSylixOS所有内核组件源码，其包含哪些组件可在向导中配置。HYSylixOSBase工程是所有项目开发的第一步，也是必须的一个步骤，后续所有工程的创建都需要指定HYSylixOSBase工程的位置；
- HYSylixOS BSP：板级支持包工程，板级支持包中一般包含HYSylixOS在某个特点的硬件平台上运行所必须的驱动和初始化程序；
- HYSylixOS Kernel Module：HYSylixOS内核模块，类似Linux系统下的\*.ko模块；
- HYSylixOS Kernel Static Lib：HYSylixOS 静态链接库程序；
- HYSylixOS Shared Lib：HYSylixOS 动态链接库程序，类似Linux系统下的\*.so文件；
- HYSylixOS Unit Test：HYSylixOS单元测试。

注：工程一旦成功创建，请不要再重命名工程。

## 创建 HYSylixOS Base 工程

在图2.1中选择“HYSylixOS Base”点击“Next”，进入图2.2所示配置页面。在“ProjectName”输入框输入工程名，工程名称不允许包含空格，取消勾选“Use defaultlocation”，可在默认Workspace之外的位置创建工程。

@import "./image/创建HYSylixOSBase工程.png"

<center>图2.2创建HYSylixOS Base工程</center>

点击“Next”进入工具链设置页面，设置基础编译选项，包括：工具链、调试级别、处理器和浮点处理器设置，如图2.3。

@import "./image/BaseProject通用设置.png"

<center>图2.3 Base Project通用设置</center>

配置项解析：

- HYSylixOS Base Project：依赖的HYSylixOS Base工程路径，此项对HYSylixOS Base工程本身无意义，不允许设置；
- Toolchain：工具链；
- Debug Level：调试级别，HYSylixOS提供Debug和Release两种配置；
- CPU Type：处理器类型；
- FPU Type：浮点类型；
- Custom Makefileconfiguration：专家模式，用户自定义Makefile，如果选中，则用户在界面上进行的所有配置，除本页所示工具链配置外，其它配置均不会被写入；
- Makefile中，这里所述Makefile包含工程目录下文件名为Makefile的文件以及所有后缀名为mk的文件。专家模式需要用户自己修改Makefile，一般用户不推荐使用专家模式；
-   Do not scan sourcefiles：不扫描源码文件。海鹰工坊会在每次用户编译时扫描工程目录下的源码文件列表并更新Makefile，如有特殊需求可不扫描，一般用户不推荐使用。CustomMakefileconfiguration为本选项的超集，如果选中，海鹰工坊也不会扫描源码文件列表。

点击“Next”进入组件选择页面，HYSylixOS包含大量可选组件，如图2.4。选中图中列表左侧复选框可包含对应组件到HYSylixOS
Base工程，选择“Select All”按钮可选中全部组件。这里点“Finish”即可完成工程创建。

@import "./image/HYSylixOSBase选择组件.png"

<center>图2.4 HYSylixOS Base 选择组件</center>

列表项解析：

- libSylixOS：SylixOS内核组件，SylixOS Base工程必选；
- libcextern：SylixOS的c库，可选组件，一般也推荐包含在SylixOS Base 工程中；
- libVxWorks：VxWorks兼容库，可选组件；
- libreadline：命令行编辑器支持库；
- liblua：lua脚本库；
- libsqlite3：SQLite数据库；
- pciutils：PCIe工具集；
- libzmodem：Zmodem 协议工具，用于串口文件传输；
- libexpat：xml解析库；
- libluaplugin：lua插件库，为lua脚本提供大量基础库。

工程向导结束后可在“ProjectExplorer”中看到新建的“SylixOS”工程，展开可看到libsylixos和libcextern组件的源码。选中新建的“SylixOS”工程，右击选择“Build
Project”编译工程，编译时间由系统配置决定，大约需要几分钟，如图 2.5。

@import "./image/编译SylixOSBase的输出文件.png"

<center>图2.5编译 SylixOS Base 的输出文件</center>

编译完成后在“libsylixos/Debug”文件夹会生成如下文件：

- libsylixos.a：内核库文件；
- libvpmpdm.so：进程补丁；
- symbol.c，symbol.h：内核导出符号表，构建bsp时需要用到；
- xinput.ko：系统输入框架内核模块，用来支持键盘鼠标等输入设备；
- xsiipc.ko：IPC内核模块，qt 会使用该模块进行进程间通信；
- libdsohandle.a：C++支持库。
  
在“libcextern/Debug”文件夹会生成如下文件：

- libcextern.so：C库。

>   在“libVxWorks/Debug”文件夹会生成如下文件：

- libVxWorks.so：VxWorks 兼容库。

>   在“libreadline/Debug”文件夹下会生成如下文件：

- libreadline.so：命令行编辑器支持库。

在“liblua/Debug”文件夹下会生成如下文件：

- liblua.so：lua脚本库；
- lua：lua脚本解析器；
- luac：lua编译器。

>   在“libsqlite3/Debug”文件夹下会生成如下文件：

- libsqlite3.so：SQLite数据库；
- sqlite3：SQLite数据库命令行工具。

>   在“pciutils/Debug”文件夹下会生成如下文件：

- lspci：PCIe枚举工具；
- setpci：PCIe设置工具；
- pci.ids：PCIe 配置文件。

>   在“libzmodem/Debug”文件夹下会生成如下文件：

- rz：文件接收程序；
- sz：文件发送程序。

>   在“libexpat/Debug”文件夹下会生成如下文件：

-   libexpat.so：xml 解析库。

所有组件同时会在“组件名称/Debug/strip”文件夹下生成经过strip处理的目标文件，如图2.6。

@import "./image/经过strip处理的目标文件.png"

<center>图2.6经过strip处理的目标文件</center>

## 部署HYSylixOS Base


编译SylixOS Base工程时生成基础库和驱动模块文件，如图2.7。

@import "./image/基础库和驱动模块位置.png"

<center>图2.7 基础库和驱动模块位置</center>

可部署的文件包括以下几种（海鹰工坊 将默认部署 strip 文件夹中文件，以减小占用的存储空间）：

- libvpmpdm.so：进程补丁文件，下载到“/lib”目录（必选）；
- xinput.ko，xsiipc.ko：下载到“/lib/modules”目录（可选，使用qt时需下载）；
- libcextern.so：c 库文件，下载到“/lib”目录（可选，使用到 c 库则下载）；
- libVxWorks.so：VxWorks兼容库，下载到“/lib”目录（可选）；
- libreadlline.so：命令行编辑器支持库（可选）；
- liblua.so：lua脚本库（可选）；
- luac.so：lua编译器（可选）；
- lua：lua命令行工具（可选）；
- libsqlite3.so：SQLite数据库（可选）；
- sqlite3：SQLite命令行工具（可选）；
- lspci：PCIe枚举工具（可选）；
- setpci：PCIe设置工具（可选）；
- pci.ids：PCIe 配置文件（可选）；
- libexpat.so：xml 文件解析库（可选）。

海鹰工坊提供工程一键部署功能，在工程创建时，根据工程类型生成不同的配置，右击工程，选择菜单“Properties”打开工程属性页，选择“HYSylixOS
Project→Device Setting”选项卡，可查看和更改部署配置。如图2.8所示。

@import "./image/SylixOSBase工程部署设置.png"

<center>图2.8 SylixOS Base 工程部署设置</center>

点击“New Device”按钮，弹出添加设备对话框，如图 2.9。

@import "./image/添加设备.png"

<center>图 2.9 添加设备</center>

配置项解析：

- Deivce Name：设备名称，即设备在本Workspace的唯一ID，不可重复，可以默认为IP，也可以自己设置名字；
- Device IP：设备IP地址；
- Telnet Port：设备telnet协议端口；
- FTP Port：设备FTP协议端口；
- GDB Port：调试应用程序时，gdbserver 端口；
- User Name：登录用户名；
- Password：登录密码。

设置完成后，点击“Finish”按钮，可在工程设备设置页面的“DeviceName”字段看到新添加的设备，如图
2.10，该设备也可以被本Workspace后续创建和配置工程使用。

@import "./image/线程状态转换图.png"

<center>图2.10 设备设置</center>
设置完成后，右键工程，选择菜单“SylixOS→Upload”部署工程。

## 创建HYSylixOS BSP工程

在图2.1对话框中选择“HYSylixOS BSP”(File→New→HYSylixOSBSP)，点击“Next”，在图2.2所示页面输入BSP工程名（本例为“HYSylixOSBSP”），可创建HYSylixOS BSP工程，点击“Next”进入图2.11界面。

@import "./image/BSPProject通用设置.png"

<center>图 2.11 BSP Project 通用设置</center>

配置项解析：

-   HYSylixOS Base Project：依赖的HYSylixOS Base工程路径，点击“FileSystem”按钮或“Workspace”按钮分别在文件系统或当前工作空间查找HYSylixOSBase工程，本例选择节2.1所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链，本项在 HYSylixOS BSP工程中不使能，自动与HYSylixOSBase工程保持一致；
- Debug Level：调试级别，HYSylixOS 提供Debug 和Release两种调试级别；
- CPU Type：处理器类型，本项在HYSylixOSBSP工程中不使能，自动与HYSylixOSBase工程保持一致；
- FPU Type：浮点类型，BSP 工程中不允许设置；
- Custom Makefileconfiguration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Do not scan source files：海鹰工坊将不自动扫描源码文件，详情见节2.1。点击“Next”按钮进入BSP模板配置页面，如图2.12。

@import "./image/HYSylixOSBSP配置.png"

<center>图2.12 HYSylixOS BSP 配置</center>

海鹰工坊内置了一些BSP模板，可根据需要选择，如无特殊需求，可选择“arch-none”模板，如本例选择“arm-mini2440”作为工程模板。不同的BSP工程模板会提供不同的链接脚本供用户配置，图2.12对话框显示
arm-mini2440模板所提供的链接脚本，设置正确的参数，本例保持默认值，点击“Finish”即可完成向导。编译即可生成一个BSP可执行镜像，如图2.13。

@import "./image/HYSylixOSBSP编译输出文件.png"

<center>图2.13 HYSylixOS BSP 编译输出文件</center>

编译完成后在 Debug 文件夹生成如下文件：

- HYSylixOSBSP.elf：elf文件；
- HYSylixOSB SP.bin：可执行镜像文件，可下载到设备运行。
海鹰工坊向导生成的BSP工程只是一个源码框架，一般需要用户根据需要修改程序代码才能在设备上运行。

## 部署 HYSylixOS BSP


BSP 镜像文件（本例为“HYSylixOSBSP.bin”）可以下载到模拟器或目标设备运行，最常见的下载方式是通过USB下载。下面通过mini2440开发板说明USB下载方式的普通流程。

mini2440开发板引导步骤如下：

1. 连接开发板串口、网络以及电源。使用串口工具打开对应串口，设置波特率为115200。
2. 关闭开发板，拨动开关，使开发板进入usb启动模式，打开开关。
3. 打开软件MiniTools（光盘中自带），选择对应的u-boot.bin和HYSylixOS
    BSP.bin。如图2.14。

@import "./image/选择镜像.png"

<center>图2.14 选择镜像</center>

1. 选择完镜像后，点击开始烧录（状态栏中，有烧录的进度提示）。如图2.15。

@import "./image/tftp服务器设置.png"

<center>图2.15 tftp 服务器设置</center>

1. 关闭电源，将开关拨至NAND启动，打开开关，即可进入系统，可使用串口工具来查看和使用系统。

## 创建HYSylixOS App工程

在图2.1对话框中选择“HYSylixOSApp”，点击“Next”，在图2.2所示页面输入App工程名（本例为“APPdemo”），可创建“HYSylixOSApp”工程，点击“Next”进入图2.16界面。

@import "./image/HYSylixOSApp工程配置.png"

<center>图2.16 HYSylixOS App 工程配置</center>

配置项解析：

- HYSylixOS Base Project：依赖的HYSylixOS Base工程路径，点击“FileSystem”按钮或 “Workspace”按钮分别在文件系统和当前工作空间查找HYSylixOSBase工程，本例选择节2.1所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链，本项在HYSylixOS App工程中不使能，自动与HYSylixOS Base工程保持一致；
- Debug Level：调试级别，HYSylixOS提供Debug和Release两种调试级别；
- CPU Type：处理器类型，本项在 HYSylixOS App工程中不使能，自动与 HYSylixOSBase工程保持一致；
- FPU Type：浮点类型，本项在 HYSylixOS App工程中不使能，自动与 HYSylixOSBase工程保持一致；
- Custom Makefile configuration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Do not scan source files：海鹰工坊 将不自动扫描源码文件，详情见节2.1。

HYSylixOS App工程向导生成了一个简单的可编译运行的应用程序，如图 2.17。

@import "./image/HYSylixOSApp编译.png"

<center>图2.17 HYSylixOS App 编译</center>

编译完成后将在Debug文件夹下生成APPdemo文件（应用程序可执行文件）。

## 部署和运行APP

首先将APP（本例为“APPdemo”）下载到目标设备，HYSylixOS推荐使用标准的应用程序目录结构，即每个应用在“/apps”目录创建自己的子目录，如本例创建“/apps/APPdemo”目录，然后将上一步编译生成的可执行文件下载到其中。可使用海鹰工坊的一键部署功能实现程序下载，右键APPdemo工程，选择菜单“Properties”打开工程属性页，选择“HYSylixOSProject→Device Setting”选项卡，可查看和更改部署配置。在创建 HYSylixOSApp工程时，海鹰工坊默认会添加工程当前配置输出文件夹下与工程名同名的文件到文件列表。

如图2.18所示，可以选择Workspace中已添加的任一存在的设备部署文件。

@import "./image/HYSylixOSApp工程部署设置.png"

<center>图2.18 HYSylixOS App 工程部署设置</center>

设置完成后，右键工程，选择菜单“HYSylixOS→Upload”部署工程。

注：如果部署不成功需要检查防火墙是否处于关闭状态。

登录HYSylixOS系统，切换到“/apps/app_demo”目录，运行“./APPdemo”可执行程序，如图2.19。

@import "./image/执行APP.png"

<center>图2.19 执行 APP</center>

海鹰工坊支持远程 Shell，进入Device页面，在目标设备上右击，点击“LaunchTerminal”可以打开设备终端，在打开的终端上输入命令运行即可，如图2.20。

@import "./image/HYSylixOS远程Shell执行APP.png"

<center>图2.20 HYSylixOS 远程 Shell 执行 APP</center>

## 创建 HYSylixOS Shared Lib工程

在图2.1对话框中选择“HYSylixOS Shared Lib”，点击Next，可创建“HYSylixOS Shared
Lib”工程，在图2.2所示页面输入工程名（本例为“lib_demo”），点击“Next”进入图2.21界面。

@import "./image/SharedLib工程配置.png"

<center>图2.21 Shared Lib工程配置</center>

配置项解析：

- HYSylixOS Base Project：依赖的HYSylixOS Base工程路径，点击“FileSystem”按钮或 “Workspace”按钮分别在文件系统和当前工作空间查找 HYSylixOS Base工程，本例选择节 2.1 所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链，本项在 HYSylixOS Shared Lib 工程中不使能，自动与HYSylixOS Base工程保持一致；
- Debug Level：调试级别，HYSylixOS 提供 Debug 和 Release 两种调试级别；
- CPU Type：处理器类型，本项在HYSylixOS Shared Lib 工程中不使能，自动与HYSylixOS Base 工程保持一致；
- FPU Type：浮点类型，本项在HYSylixOS Shared Lib工程中不使能，自动与 HYSylixOSBase工程保持一致；
- Custom Makefileconfiguration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Do not scan source files：海鹰工坊将不自动扫描源码文件，详情见节 2.1。

HYSylixOS SharedLib工程向导生成了一个简单的可编译运行的动态链接库程序，如图2.22。

@import "./image/HYSylixOSSharedLib编译.png"

<center>图2.22 HYSylixOS Shared Lib 编译</center>

编译完成后生成如下文件：

- liblib_demo.so：动态链接库文件；
- liblib_demo.a：静态链接库文件。

## 部署动态链接库


将上一步编译的动态链接库文件（本例为“lib_demo.so”）下载到HYSylixOS库“/lib”目录（或者其他HYSylixOS动态库搜索路径，如“/usr/lib”、“/usr/local/lib”等）。如果应用程序在编译时引用了该库文件，则在应用程序运行时，加载器会自动加载动态链接库。

可以使用海鹰工坊的一键部署功能实现程序下载，右键lib_demo工程，选择菜单“Properties”打开工程属性页，选择“HYSylixOS
Project→Device Setting”选项卡，可查看和更改部署配置。在创建HYSylixOS Shared
Lib工程时，海鹰工坊默认会添加工程当前配置输出文件夹下与工程名同名的文件到文件列表，如图
2.23。

@import "./image/HYSylixOSSharedLib工程部署设置.png"

<center>图2.23 HYSylixOS Shared Lib 工程部署设置</center>

设置完成后，右键工程，选择菜单“HYSylixOS→Upload”部署工程。

## 创建 HYSylixOS Kernel Module 工程

在图2.1对话框中选择“HYSylixOS Kernel Module”（其它操作同 HYSylixOSBase），可以创建“HYSylixOS Kernel Module”工程，点击“Next”进入图2.24界面。

@import "./image/HYSylixOSKernelModule配置.png"

<center>图2.24 HYSylixOS Kernel Module 配置</center>

配置项解析：

- HYSylixOS Base Project：依赖的Base Project工程路径，点击“FileSystem”按钮或“Workspace”按钮分别在文件系统和当前工作空间查找BaseProject，本例选择节2.1所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链，本项在HYSylixOS App工程中不使能，自动与HYSylixOSBase工程保持一致；
- Debug Level：调试级别，HYSylixOS提供Debug和Release两种调试级别；
- CPU Type：处理器类型，本项在HYSylixOS App工程中不使能，自动与 HYSylixOSBase工程保持一致；
- FPU Type：浮点类型，本项在HYSylixOS App工程中不使能，自动与HYSylixOSBase工程保持一致；
- Custom Makefileconfiguration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Do not scan source files：海鹰工坊 将不自动扫描源码文件，详情见节 2.1。

HYSylixOS Kernel Module工程向导生成了一个简单的可编译和动态装载的内核模块，如图2.25。

@import "./image/HYSylixOSKernelModule编译.png"

<center>图2.25 HYSylixOS Kernel Module 编译</center>

编译完成后在 Debug 文件夹里生成 mod_demo.ko 文件（内核模块）。

## 部署内核模块


使用海鹰工坊的一键部署功能可以将上一步编译的内核模块文件（本例为“mod_demo.ko”）下载到“/lib/modules”目录，配置方法如下：右键mod_demo工程，选择菜单“Properties”打开工程属性页，选择“HYSylixOSProject→Device Setting”选项卡查看或更改部署配置。在创建HYSylixOS KernelModule工程时，海鹰工坊默认会添加工程当前配置输出文件夹下与工程名同名的文件到文件列表，如图 2.26。

@import "./image/HYSylixOSKernelModule工程部署设置.png"

<center>图2.26 HYSylixOS Kernel Module 工程部署设置</center>

设置完成后，右键工程，选择菜单“HYSylixOS→Upload”部署工程。
在HYSylixOS Shell 上，运行“modulereg”命令加载内核模块，然后使用“modules”命令查看当前已经加载的内核模块，并可以获得模块句柄（“HANDLE”部分）根据获取到的模块句柄，使用“moduleunreg”命令可卸载内核模块，如图2.27。

@import "./image/部署模块相关命令.png"

<center>图2.27 部署模块相关命令</center>

注：printk函数只会输出到串口终端，如果在module_init或module_exit函数中使用了printk函数作为输出函数，则telnet终端上不会打印输出。

## 创建HYSylixOS Kernel Static Lib工程


在图2.1对话框中选择“HYSylixOS Kernel Static Lib”(其它操作同HYSylixOSBase)，可创建 “HYSylixOS Kernel Static Lib”工程，点击“Next”进入图2.28界面。

@import "./image/SharedLib工程配置.png"

<center>图2.28 Shared Lib工程配置</center>

配置项解析：

- HYSylixOS Base Project：依赖的 HYSylixOS Base工程路径，点击“FileSystem”按钮或 “Workspace”按钮分别在文件系统和当前工作空间查找HYSylixOSBase工程，本例选择节2.1所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链，本项在HYSylixOS Shared Lib工程中不使能，自动与 HYSylixOSBase工程保持一致；
- Debug Level：调试级别，HYSylixOS 提供Debug和Release两种调试级别；
- CPU Type：处理器类型，本项在 HYSylixOS Shared Lib 工程中不使能，自动与HYSylixOS Base 工程保持一致；
- FPU Type：浮点类型，本项在HYSylixOS Shared Lib工程中不使能，自动与 HYSylixOSBase工程保持一致；
- Custom Makefile configuration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Do not scan source files：海鹰工坊 将不自动扫描源码文件，详情见节2.1。

HYSylixOS Static Lib工程向导生成了一个简单的可编译运行的静态链接库程序，如图2.29。

@import "./image/HYSylixOSStaticLib编译.png"

</center>图2.29 HYSylixOS Static Lib 编译</center>

编译完成后生成lib_demo_static.a文件（静态链接库文件）。需要特别说明的是HYSylixOS StaticLib的编译参数中不带-fPIC选项，因此生成\*.a文件只能用于HYSylixOSBSP工程链接，不能用于HYSylixOS应用程序和动态库的链接。HYSylixOS Shared Lib工程中同样会生成\*.a文件，该文件的编译选项中带-fPIC参数，可用于HYSylixOS应用程序和动态库的链接。

# 导入工程


海鹰工坊工程是HYSylixOS源码管理的原子单位，可以在多个海鹰工坊Workspace间移动和共享工程。HYSylixOS官方源码版本库中的源码同样以海鹰工坊工程形式组织，从版本库检出的工程可以被导入到海鹰工坊
Workspace中。

## 工程导入

本文档假定已经从HYSylixOS官方源码版本库中检出了最新的BSP工程源码。选择菜单“File→Import”，打开Import对话框，如图3.1。

@import "./image/导入工程.png"

<center>图3.1 导入工程</center>

选中“HYSylixOS Projects”，点击“Next”按钮进入工程选择界面，如图3.2。

@import "./image/选择导入工程.png"

<center>图3.2 选择导入工程</center>

点击“Browse”按钮，在弹出文件夹选择框中选中工程所在目录，在Projects列表中会列出该目录下可被导入的工程名称，选中需要导入的工程，点击“Finish”按钮完成工程导入。导入工程成功后，可在Workspace工程列表中看到新导入的工程，如图3.3。

## 工程删除


@import "./image/工程导入完成.png"

<center>图3.3工程导入完成</center>

右击待删除工程，选择菜单“Delete”可删除工程，如图3.4。

@import "./image/删除工程.png"

<center>图3.4删除工程</center>

## 修改工程


海鹰工坊使用Makefile方式管理工程，Makefile在创建工程时生成，在非专家模式下不需要用户手动维护。海鹰工坊提供规范简单的Makefile模板，在专家模式下用户可以很方便的对Makefile进行修改。

## 修改工程通用设置


右键需要修改的工程，选择菜单“Properties”打开工程属性页，选择“HYSylixOSProject”，在弹出对话框中可以更改“SylixOS Base Project”、“Debug Level”及“Expert
Mode Setting”，如图4.1。为了保证通用设置与“SylixOSBase Project”选项指定的SylixOSBase工程保持一致，其他选项默认不可更改。

@import "./image/修改通用设置.png"

<center>图4.1 修改通用设置</center>

配置项解析：

- HYSylixOS Base Project：依赖的HYSylixOS BaseProject工程路径，点“FileSystem”按钮或“Workspace”按钮分别在文件系统和当前工作空间查找BaseProject，本例选择节2.1所创建的名为“HYSylixOS”的工程；
- Toolchain：工具链名称，与选择的Base工程一致，不能手动更改；
- DebugLevel：调试级别，HYSylixOS提供Debug和Release两种配置；
- CPUType：处理器类型，与选择的Base工程一致，不能手动更改；
- FPUType：浮点类型，与选择的Base工程一致，不能手动更改；
- Custom Makefileconfiguration：专家模式，用户可手动配置Makefile，详情见节2.1；
- Donotscan source files：海鹰工坊将不自动扫描源码文件，详情见节2.1。

点击“OK”或“Apply”按钮确认更改，海鹰工坊会自动生成Makefile配置。

海鹰工坊重新生成工程根目录下的config.mk文件，工程根目录下的config.mk文件不允许手动修改。

## 添加源文件


选中工程，选择菜单“File→New→SourceFile”弹出新建源文件对话框，在“Sourcefile”编辑框输入源文件名称，然后点击“Finish”按钮可创建源文件，如图4.2。

@import "./image/新建源文件.png"

<center>图4.2 新建源文件</center>

在不选中“专家模式”时，海鹰工坊会自动将新添加的源文件一起编译，编译后查看APPdemo.mk文件，可以看到源文件列表已经自动添加了新建的源文件，如图4.3。

@import "./image/源文件列表.png"

<center>图4.3 源文件列表</center>

## 添加头文件路径


右击需要添加头文件路径的工程，选择菜单“Properties”，选择“HYSylixOSProject”下的“Compiler Setting”，点击“IncludePath”选项卡，选择所添加头文件的路径，保存设置即可，如图4.4。

@import "./image/添加头文件设置.png"

<center>图4.4 添加头文件设置</center>

在不选中“专家模式”时，海鹰工坊会自动将新添加的头文件一起编译，编译后查看APPdemo.mk文件，可以看到头文件路径列表已经自动添加新增的头文件路径，如图4.5。

@import "./image/头文件路径列表.png"

</center>图4.5 头文件路径列表</center>

## 添加动态库

在需要添加动态库的工程上右击，选择菜单“Properties”，在弹出窗口上点击“HYSylixOSProject”下的“Linker Setting”，在工作空间中选择要添加的库文件，如图4.6。

@import "./image/添加动态库设置.png"

</center>图4.6 添加动态库设置</center>

点击“OK”后，在弹出的对话框“Add pathto library pathsetting？”中选择“是”可以自动添加库文件的路径。如图4.7，在“LibraryPath”选项卡可以看到已经加入了添加的库文件路径，在不选中“专家模式”时，编译工程后打开“源文件名.mk”文件，可以看到“Dependlibrary”下自动添加了库文件。

@import "./image/动态库路径自动添加.png"

<center>图4.7 动态库路径自动添加</center>

## 专家模式


在专家模式下，新建的源文件，新增的头文件路径，新增的动态库等都需要用户手动设置，主要是修改“源文件名.mk”文件，如图4.8。其中主要几项说明如下：

- “LOCAL_TARGET_NAME”：输出文件，可以设置工程的多目标输出；
- “LOCAL_SRCS”：源文件列表，添加源文件后，需要在此列表中添加后才能编译；
- “LOCAL_INC_PATH”：头文件搜索路径，添加头文件后，需在此添加后才能搜索；
- “LOCAL_DSYMBOL”：预定义宏；
- “LOCAL_DEPEND_LIB”：依赖的库文件，添加的库文件需在此列出；
- “LOCAL_DEPEND_LIB_PATH”：依赖的库文件路径；
- “LOCAL_USE_GCOV”：是否启用代码覆盖率分析。

@import "./image/专家模式下手动设置项.png"

<center>图4.8 专家模式下手动设置项</center>

# 海鹰工坊调试


HYSylixOS实现了一个功能强大的调试stub，可在设备或模拟器上在线调试应用程序，海鹰工坊也提供配套的调试插件。目前海鹰工坊既支持自动推送调试、也支持传统的手动启动gdbserver的调试方式。本节将逐一介绍。

注：本节所述调试方法同时适应硬件设备和RealEvo-Simulator模拟器上运行的应用程序，内核和BSP的调试方法请参考附件中的《RealEvo-Simulator使用手册》。
注：需要注意，调试应用程序依赖的libvpmpdm.so必须是Debug版本，否则将会因为Release版本的libvpmpdm.so没有调试信息导致未知的错误，这个问题会在所有被调试应用程序链接的动态库（如：libcextern等）上出现。

## 一键推送调试

使用海鹰工坊实现一键推送调试功能，不需要用户在设备上手动启动gdbserver，也不需要用户手动下载程序到设备。其操作流程如下：
选中需要调试的工程，这里选择“APPdemo”工程，按照图2.18设置设备，并保证可以成功连接到设备。右键“APPdemo”工程，点击“DebugAs→HYSylixOS RemoteApplication”可以直接进入调试，这种方式简单快捷，但在调试退出后并不保存调试对象。

下面介绍建立调试器的一键推送调试方法。选中工程，选择菜单“Run→Debug Configurations”打开调试器界面。选择“HYSylixOS Remote Application”，点击“New launchconfiguration”按钮，新建一个调试器对象，并在“Name”编辑框填写调试器对象名字，本例为“app_demo_auto”，点击“Apply”应用设置，点击“Debug”开始调试，如图5.1。

@import "./image/新建调试器.png"

<center>图5.1 新建调试器</center>

注：选择Non-stop复选框将启用Non-stop调试模式，Non-stop调试模式详细信息见5.6节。

调试界面如图5.2，可以在“Console”标签页查看gdb输出信息，在“Terminal”标签页查看调试过程中应用程序输出信息，并可输入执行Shell命令。

@import "./image/设备调试界面.png"

<center>图5.2 设备调试界面</center>

点击停止按钮或程序退出可以结束调试，调试结束后点击图5.3中红色标识按钮下拉菜单中的调试器对象（本例为“app_demo_auto”）可重新开始调试。

@import "./image/停止和重新开始调试.jpg"

<center>图5.3 停止和重新开始调试</center>

海鹰工坊依据应用程序修改时间判断是否需要重新推送程序，所以无须担心推送程序所产生的网络流量和读写延时问题。

## 手动启动调式


注：本节涉及的Shell命令可参考附件中的《海鹰翼辉嵌入式操作系统Shell命令手册》。

-   **启动gdbserver。**

使用debug命令启动应用程序。在命令中指定监听的网络接口和端口，后跟需要启动的应用程序和参数，如图5.4。

@import "./image/启动gdbserver.png"

<center>图5.4 启动gdbserver</center>

注：上面命令中“./APPdemo”中的“./”不能省略，否则程序加载器只会在\$PATH路径下查找，不会查找当前路径。

-   **配置gdb。**

选中需要调试的工程，这里选择“app_demo”工程，选择菜单“Run→DebugConfigurations”打开调试器界面。

选择“HYSylixOS RemoteApplication”，新建一个调试器对象，命名为“app_demo_manu”，点击“Selectother...”按钮，在弹出框中使能“Useconfiguration specific settings”，再在下方列表中选择“HYSylixOS Manual Remote AppDebugging Launcher”，点击“OK”创建调试器，如图5.5。

@import "./image/选择HYSylixOS Manual Remote APP Debugging Launcher.png"

<center>图5.5 选择HYSylixOS Manual Remote APP Debugging Launcher</center>

点击“SearchProject”按钮选择Debug文件夹下的目标文件，注意：不能选择Debug/strip文件夹下的文件，因为strip后的文件不带调试信息，如图5.6。

@import "./image/选择调试目标文件.png"

<center>图5.6 选择调试目标文件</center>

打开“Debugger→Connection”属性页，“Type”下拉框选择“TCP”，在“HostnameorIPaddress”编辑框中输入目标设备IP（本例为“192.168.7.30”），在“Portnumber”编辑框输入gdbserver端口号，配置完成后点击“Apply”保存设置，点击“Debug”开始调试，如图5.7。

@import "./image/设置设备地址.png"

<center>图5.7 设置设备地址</center>

## 串口调试


对于不支持以太网接口的设备，可以使用串口进行手动启动调试。其操作流程与以太网调试基本一致，可参考5.2节，有以下两点区别。

1. 通过串口连接PC与设备，在设备端使用/dev/ttyS\*参数启动debug命令，如图5.8。

@import "./image/通过串口启动debug.png"

</center>图5.8 通过串口启动debug</center>

图中的命令参数“/dev/ttyS1”为设备端与PC相连的串口在HYSylixOS中的名称。

1. 打开“Debugger→Connection”属性页，在“Type”下拉框选择“Serial”，在“Device”编辑框中输入PC端与设备相连的调试串口名称，在“Speed”编辑框设置串口波特率，HYSylixOS调试串口波特率为115200，如图5.9。

@import "./image/调试串口设置.png"

<center>图5.9 调试串口设置</center>

注：如果目标设备没有第二个可以用于调试的串口，可以通过命令“debugterminal./APPdemo”将当前串口用于调试串口，但是需要注意的是调试启动后需要将串口关闭，否则海鹰工坊将会出现连接失败的错误。

## 动态库调试


HYSylixOS支持动态库调试，添加动态库的方法详见节4.4。修改APPdemo代码，调用lib_demo.so动态库中的函数，如图5.10。再按照节2.8部署依赖的库文件。

@import "./image/调用so库.png"

<center>图5.10 调用so库</center>

一键推送调试添加动态库的方法如下：打开调试对象（本例为“app_demo_auto”）的：“Debugger”选项卡，在“LibraryPaths Setting”的下拉菜单里选择“Add library paths from projectsetting”，可以看到“Path”框下默认添加了动态库，如图5.11。

@import "./image/添加动态库一键推送调试.png"

</center>图5.11 添加动态库一键推送调试</center>

点击“Debug”开始调试，此时可跟踪到so库文件的函数中，如图5.12。

@import "./image/动态库调试界面.png"

<center>图5.12 动态库调试界面</center>

手动调试添加动态库的方法如下：打开调试对象（本例为“app_demo_manu”）的“Debugger”选项卡，在“SharedLibraries”选项卡里添加库文件路径，如图5.13。

@import "./image/手动调试添加动态库.png"

<center>图5.13 手动调试添加动态库</center>

## Attach到进程


-   **启动应用程序**

为便于定位突发问题，HYSylixOS支持Attach到现有进程的调试方式。为演示Attach调试方式，本例修改源码，如图5.14让应用程序以死循环方式不间断运行。

@import "./image/程序示例.png"

<center>图5.14 程序示例</center>

部署应用程序（本例上传到“192.168.1.30”），在“Device”页面，右键“192.168.1.30”设备，点击“LaunchDevice”打开设备信息，切换到“Process”页已查看进程信息。右键“192.168.1.30”设备，点击“LaunchTerminal”，打开设备终端，并在终端上启动上述程序。如图5.15，可从“Process”页的“PID”列表上获得进程id。

@import "./image/启动程序并查看id.png"

<center>图5.15 启动程序并查看id</center>

-   **配置gdb**

选中需要调试的工程，这里选择“APPdemo”工程，选择菜单“Run→DebugConfigurations”打开调试器界面。

选择“HYSylixOS RemoteApplication”，新建一个调试器对象，命名为“app_demo_attach”，选择“Selectother...”按钮，在弹出框中使能“Useconfiguration specific setting”，再在下方列表中选择“HYSylixOS Attach Remote AppDebugging Lancher”，点击“OK”创建调试器，如图5.16。

@import "./image/新建Attach调试.png"

<center>图5.16 新建Attach调试</center>

Attach调试设置与前面所说的自动推送调试方式的配置界面基本一致，只增加了被调试进程id的编辑框，每次开启调试前需要远程连接到目标板使用ps命令观察被调试程序id，并在海鹰工坊中重新配置目标进程id，如图5.17。

@import "./image/Attach到进程调试器配置.png"

<center>图5.17 Attach到进程调试器配置</center>

点击“Apply”保存配置，点击“Debug”可开始调试。注意：被Attach的应用程序在Debug退出时不会自动退出，而是继续运行，直到程序正常退出，如图5.18。

@import "./image/Attach到进程调试.png"

</center>图5.18 Attach到进程调试</center>

手动调试方式也支持Attach到进程，修改debug启动命令，添加“--attach”参数，如图5.19。

@import "./image/gdbserverattach进程.png"

<center>图5.19 gdbserver attach进程</center>

手动Attach进程方式下的海鹰工坊设置与5.2节所述手动启动gdbserver调试方式的海鹰工坊设置相同。

## Non-stop模式


在多线程调试时，可能需要调试某特定线程，Non-stop模式可以使进程在碰到断点时只停止断点线程，其它线程继续全速运行。HYSylixOS系统中，上述所有调试方式都支持Non-stop模式。在“Run→DebugConfigurations”对话框中，打开“Debugger→Main”属性页，使能“Non-stopmode”即可打开Non-stop模式。如图5.20。

@import "./image/使能Non-stop模式.png"

<center>图5.20 使能Non-stop模式</center>

# 设备管理


## 设备实时监控

海鹰工坊支持对在线设备的实时监控。进入“Device界面”，在左侧“Remote SystemNavigator”区域列出了工程中设置的所有设备。也可以在该区域点击右键，新建一个设备，按图2.9设置。右键一个在线设备，点击“LaunchDevice”，在“SystemInformation”下列出了设备的内存信息、当前运行的进程及线程信息，如图6.1。设备信息每6s自动刷新一次，也可以在某个信息页面上点击右键手动刷新。对于非内核进程或线程，可以点击右键选择“KillProcess”或“Kill Thread”杀死该进程或线程。

@import "./image/设备实时监控.png"

</center>图6.1 设备实时监控</center>

## HYSylixOS远程Shell

海鹰工坊支持打开在线设备的终端。右键一个在线设备，点击“LaunchTerminal”，打开设备终端。在此终端上可以执行HYSylixOSShell命令，并且使用鼠标可以将光标移动到当前命令行的任意位置，如图6.2。

@import "./image/设备终端.png"

</center>图6.2 设备终端</center>

## 设备文件系统访问


海鹰工坊支持访问在线设备的文件系统。右键一个在线设备，点击“LaunchFtp”，打开设备文件系统，如图6.3。在本地选择文件后，右键“Upload”可以将文件上传到设备文件系统，在设备上选择文件后，右键“Download”可以将文件下载到本地，如图6.4。对于设备上的文件，右键“Permissions”可以更改文件权限。

@import "./image/打开设备文件系统.png"

<center>图6.3 打开设备文件系统</center>

@import "./image/向目标设备上传文件.png"

<center>图6.4 向目标设备上传文件</center>

## TFTP服务器


海鹰工坊支持tftp传输文件。点击“Tools”→“TFTPServer”，在弹出的对话框中选择待传输文件的文件夹，点击“Start”后启动传输，如图6.5。

@import "./image/TFTP传输设置.png"

<center>图6.5 TFTP传输设置</center>

在目标设备终端上输入tftp传输命令，可以看到成功接收了文件，如图6.6。

@import "./image/目标设备接收经tftp传输的文件.png"

<center>图6.6 目标设备接收经tftp传输的文件</center>

注：如果部署不成功需要检查防火墙是否处于关闭状态。

# 代码分析


## 静态代码分析


右击需要分析的工程，选择菜单“Code Static Analysis→Run Code StaticAnalysis”可分析工程源码。选中“Console→cppcheck”标签页可查看分析过程，如图7.1。

@import "./image/代码静态分析输出.png"

<center>图7.1 代码静态分析输出</center>

## 程序代码覆盖率分析


程序代码覆盖率分析主要分为以下几步：

1. 右击需要分析的工程，选择菜单“Properties”，选择“HYSylixOSProject”下的“Compiler Setting”，在弹出的窗口中勾选“Enable gcov（Codecoverage analysis）”，“OK”保存设置，如图7.2。
   
@import "./image/代码覆盖率分析设置.png"

<center>图7.2 代码覆盖率分析设置</center>

2. 编译程序，在工程编译输出目录的 obj 文件夹下会为被编译的每个源文件生成“源文件
    名.o”和“源文件名.gcno”文件，如图 7.3。

@import "./image/编译结构.png"

<center>图7.3 编译结构</center>

3. 上传应用程序可执行文件（本例为“APPdemo”）到目标设备并执行文件，程序退出后在可执行文件同级目录下会生成obj目录，该目录中保存了每个源文件在程序执行后生成的
    “源文件名.gcda”文件，如图 7.4。

@import "./image/gcov程序运行.png"

<center>图7.4 gcov 程序运行</center>

4. 右击需要分析的工程，选择“HYSylixOS Coverage Analysis→Show Coverage Rate”。

至此，每个源文件在程序工程编译输出目录下的 obj文件夹中存在三个与之对应的文件，即：“源文件名.o”，“源文件名.gcno”和“源文件名.gcda”。在 gcov 标签页中可查看源文件代码覆盖率，双击列表中的行可定位到源代码，同时在源码文件中以不同的颜色标识各行代码的执行次数。选中列表中的“APPdemo.c”一行，点击

@import "./image/工具.png"，选择“Bar graph”，可以更直观的查看代码覆盖率分析图，如图 7.5。

@import "./image/gcov视图.png"

</center>7.5 gcov 视图</center>

注：如果更改了源文件，在第四步中需要先选择“HYSylixOS Coverage Analysis→GetCoverage Rate File”，再选择“HYSylixOS Coverage Analysis→Show Coverage Rate”。

内核模块代码覆盖率分析与应用程序基本一致，不一样的是内核模块不能被执行，需运行“modulegcov”命令生成“源文件名.gcda”文件。其操作流程如下：

1. 模块中添加如下代码。

| extern void gcov_flush(); |
|---------------------------|


>   LW_SYMBOL_EXPORT void module_gcov (void)

>   {

>   gcov_flush();

>   printk("module_gcov() run!\\n");

>   }

1.  按照图7.2设置工程，编译并下载内核模块文件到目标系统，注册模块并执行
    “modulegcov”命令，生成“源文件名.gcda”文件，如图7.6。

@import "./image/执行modulegcov命令.png"

</center>图7.6 执行modulegcov命令</center>

1. 右击需要分析的工程，选择“HYSylixOS Coverage Analysis→Show CoverageRate”。至此，每个源文件会在程序工程编译输出目录下的obj文件夹中都存在三个与之对应的文件，即：“源文件名.o”，“源文件名.gcno”和“源文件名.gcda”。选择过工程目标文件后即可查看代码覆盖率分析结果，如图7.7。在gcov标签页中可查看源文件代码覆盖率，双击列表中的行可定位到源代码，同时在源码文件中以不同的颜色标识各行代码的执行次数。选中某一行，点击，选择“Bargraph”，可以更直观的查看代码覆盖率分析图，如图 7.8。

@import "./image/选择bin文件.png"

</center>图7.7 选择bin文件</center>

@import "./image/内核模块gcov视图.png"
</center>图7.8 内核模块gcov视图</center>
